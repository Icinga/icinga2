#!/usr/bin/make -f

#export DH_VERBOSE=1

export NOCONFIGURE=1

%:
	dh $@  --with autotools-dev

override_dh_auto_clean:
	dh_auto_clean
	rm -f config.log
	rm -f config.status

override_dh_auto_configure:
	./autogen.sh
	dh_auto_configure -- --enable-python \
        --with-icinga-user=root \
        --with-icinga-group=bin \
        --with-icingacmd-user=root \
        --with-icingacmd-group=bin

override_dh_auto_install:
	dh_auto_install
	# cleanup dependencies in .la files
	sed -i "/dependency_libs/ s/'.*'/''/" `find debian/tmp/ -name '*.la'`

override_dh_install:
	dh_install
	# remove ido files from other packages
	if [ -d debian/icinga2-common/ ]; then rm debian/icinga2-common/etc/icinga2/features-available/ido-mysql*; fi
	rm debian/icinga2-bin/usr/lib/*/icinga2/libdb_ido_mysql*

override_dh_installinit:
	dh_installinit --name=icinga2

# vi: noexpandtab :
