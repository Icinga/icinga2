name: Linux

on:
  push: {}
  pull_request: {}

jobs:
  linux:
    name: ${{ matrix.distro }}
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      max-parallel: 2
      matrix:
        distro:
          - centos:7 # and RHEL 7

    steps:
      - name: Checkout HEAD
        uses: actions/checkout@v3

      - name: Restore/backup ccache
        uses: actions/cache@v3
        with:
          path: ccache
          key: ccache/${{ matrix.distro }}

      - name: Build
        run: >-
          docker run --rm -v "$(pwd):/icinga2" -e DISTRO=${{ matrix.distro }}
          ${{ matrix.distro }} /icinga2/.github/workflows/linux.bash
